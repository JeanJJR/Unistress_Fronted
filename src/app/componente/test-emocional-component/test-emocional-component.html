<div class="main-content">
  <h2 class="page-title">Test Emocional</h2>

  <!-- Botón inicial -->
  <!-- Botón inicial -->
  <button *ngIf="!mostrarFormulario"
          mat-raised-button
          class="btn-gradient"
          (click)="iniciarTest()">
    Iniciar Test
  </button>

  <!-- Spinner de carga -->
  <div *ngIf="isLoading && mostrarFormulario" class="spinner-container">
    <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
    <p>Cargando preguntas...</p>
  </div>

  <!-- Formulario del test -->
  <form *ngIf="mostrarFormulario && !isLoading"
        [formGroup]="testForm"
        (ngSubmit)="onSubmit()">

    <mat-card class="instructions-card">
      <mat-card-content>
        <p>Responde a las siguientes preguntas según cómo te has sentido últimamente.
          <br>
          <strong>1</strong> = Completamente en desacuerdo, <strong>5</strong> = Completamente de acuerdo.
        </p>
      </mat-card-content>
    </mat-card>

    <div formArrayName="respuestas">
      <div *ngFor="let pregunta of preguntasTest; let i = index" class="question-block">
        <p class="question-text">{{ i + 1 }}. {{ pregunta.enunciado }}</p>

        <mat-radio-group [formControlName]="i" class="options-group">
          <mat-radio-button *ngFor="let opcion of opcionesRespuesta" [value]="opcion.value">
            <span class="radio-label-text">{{ opcion.label }}</span>
          </mat-radio-button>
        </mat-radio-group>
      </div>
    </div>

    <button type="submit" mat-raised-button color="primary" class="btn-enviar"
            [disabled]="testForm.invalid || isSubmitting">
      {{ isSubmitting ? 'Enviando...' : 'Enviar' }}
    </button>
  </form>
</div>
